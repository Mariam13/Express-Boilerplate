var mongoose = require('mongoose');
var config = require('../config/env');
var logger = require('../logger');

var Db = function (dbConfig) {
    this.connected = false;
    this.connection = null;
    this.config = dbConfig;
    this.connectionInProgress = false;
};

Db.prototype.connect = function () {
    this.connectionInProgress = true;
    if (!this.connected) {
        var uri = this.config.host + ':' + this.config.port;
        mongoose.connect(uri);
        this.connection = mongoose.connection;
        this.connection.on('error', function (err) {
            this.connectionInProgress = false;
            logger.log('error', 'MongoDb error', err);
        }.bind(this));
        this.connection.once('open', function () {
            this.connected = true;
            this.connectionInProgress = false;
        }.bind(this));
    }
};

var dbConnection = new Db(config.db);

module.exports = dbConnection;
